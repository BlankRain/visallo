sudo: false
language: java
jdk:
  - oraclejdk8
env:
  - CC=clang CXX=clang++
script: mvn -B -q -fae test -Ptest-exclude-native -DlogQuiet
after_success:
  - test $TRAVIS_REPO_SLUG == "v5analytics/visallo" && test $TRAVIS_BRANCH == "master" && test $TRAVIS_PULL_REQUEST == "false" && echo "<settings><servers><server><id>v5analytics-snapshots</id><username>\${env.DEPLOY_USERNAME}</username><password>\${env.DEPLOY_PASSWORD}</password></server></servers></settings>" > ~/settings.xml
  - test -f ~/settings.xml && mvn --settings ~/settings.xml -f root/pom.xml -DdistributionManagement.target=org.visallo deploy
  - test -f ~/settings.xml && mvn --settings ~/settings.xml -DdistributionManagement.target=org.visallo deploy
branches:
  only:
    - master
